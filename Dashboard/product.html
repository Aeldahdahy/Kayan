<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Products</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="language-toggle">
        <button id="en-btn">English</button>
        <button id="ar-btn">العربية</button>
    </div>
    <div class="header">
        <h1 id="page-title">Manage Products</h1>
    </div>
    <div class="container">
        <form id="productForm">
            <h2 id="form-title">Create or Update Product</h2>
            <input type="hidden" id="productId">
            <input type="text" id="productName" placeholder="Product Name" required>
            <textarea id="productDescription" placeholder="Product Description" rows="4" required></textarea>
            <input type="number" id="productSale" placeholder="Product Sale Price" required>
            <input type="number" id="stockQuantity" placeholder="Stock Quantity" required>
            <select id="subcategoryId" required>
                <option value="" disabled selected id="select-subcategory">Select Subcategory</option>
            </select>
            <select id="brandId" required>
                <option value="" disabled selected id="select-brand">Select Brand</option>
            </select>
            <input type="file" id="productImage">
            <button type="submit" id="save-button">Save Product</button>
        </form>
        <h2 id="products-title">All Products</h2>
        <table>
            <thead>
                <tr>
                    <th id="id-column">ID</th>
                    <th id="name-column">Name</th>
                    <th id="description-column">Description</th>
                    <th id="sale-price-column">Sale Price</th>
                    <th id="stock-column">Stock</th>
                    <th id="subcategory-column">Subcategory</th>
                    <th id="brand-column">Brand</th>
                    <th id="image-column">Image</th>
                    <th id="actions-column">Actions</th>
                </tr>
            </thead>
            <tbody id="productList">
                <!-- Dynamic content -->
            </tbody>
        </table>
        <a href="dashboard.html" class="back-btn btn" id="back-button">Back</a>
    </div>
    <script>
            const API_BASE = "http://localhost:3000/api";

            const translations = {
                en: {
                    pageTitle: "Manage Products",
                    formTitle: "Create or Update Product",
                    productNamePlaceholder: "Product Name",
                    productDescriptionPlaceholder: "Product Description",
                    productSalePlaceholder: "Product Sale Price",
                    stockQuantityPlaceholder: "Stock Quantity",
                    selectSubcategory: "Select Subcategory",
                    selectBrand: "Select Brand",
                    saveButton: "Save Product",
                    productsTitle: "All Products",
                    idColumn: "ID",
                    nameColumn: "Name",
                    descriptionColumn: "Description",
                    salePriceColumn: "Sale Price",
                    stockColumn: "Stock",
                    subcategoryColumn: "Subcategory",
                    brandColumn: "Brand",
                    imageColumn: "Image",
                    actionsColumn: "Actions",
                    editButton: "Edit",
                    deleteButton: "Delete",
                    backButton: "Back"
                },
                ar: {
                    pageTitle: "إدارة المنتجات",
                    formTitle: "إنشاء أو تحديث منتج",
                    productNamePlaceholder: "اسم المنتج",
                    productDescriptionPlaceholder: "وصف المنتج",
                    productSalePlaceholder: "سعر البيع",
                    stockQuantityPlaceholder: "الكمية المتوفرة",
                    selectSubcategory: "اختر الفئة الفرعية",
                    selectBrand: "اختر العلامة التجارية",
                    saveButton: "حفظ المنتج",
                    productsTitle: "جميع المنتجات",
                    idColumn: "الرقم التعريفي",
                    nameColumn: "الاسم",
                    descriptionColumn: "الوصف",
                    salePriceColumn: "سعر البيع",
                    stockColumn: "الكمية",
                    subcategoryColumn: "الفئة الفرعية",
                    brandColumn: "العلامة التجارية",
                    imageColumn: "الصورة",
                    actionsColumn: "الإجراءات",
                    editButton: "تعديل",
                    deleteButton: "حذف",
                    backButton: "رجوع"
                }
            };

            const pageTitle = document.getElementById("page-title");
            const formTitle = document.getElementById("form-title");
        const productName = document.getElementById("productName");
        const productDescription = document.getElementById("productDescription");
        const productSale = document.getElementById("productSale");
        const stockQuantity = document.getElementById("stockQuantity");
        const subcategorySelect = document.getElementById("subcategoryId");
        const brandSelect = document.getElementById("brandId");
            const saveButton = document.getElementById("save-button");
            const productsTitle = document.getElementById("products-title");
            const idColumn = document.getElementById("id-column");
            const nameColumn = document.getElementById("name-column");
            const descriptionColumn = document.getElementById("description-column");
            const salePriceColumn = document.getElementById("sale-price-column");
            const stockColumn = document.getElementById("stock-column");
            const subcategoryColumn = document.getElementById("subcategory-column");
            const brandColumn = document.getElementById("brand-column");
            const imageColumn = document.getElementById("image-column");
            const actionsColumn = document.getElementById("actions-column");
            const backButton = document.getElementById("back-button");

            const langButtons = document.querySelectorAll(".language-toggle button");

            function applyTranslations(lang) {
                pageTitle.textContent = translations[lang].pageTitle;
                formTitle.textContent = translations[lang].formTitle;
                productName.placeholder = translations[lang].productNamePlaceholder;
                productDescription.placeholder = translations[lang].productDescriptionPlaceholder;
                productSale.placeholder = translations[lang].productSalePlaceholder;
                stockQuantity.placeholder = translations[lang].stockQuantityPlaceholder;
                subcategorySelect.options[0].textContent = translations[lang].selectSubcategory;
                brandSelect.options[0].textContent = translations[lang].selectBrand;
                saveButton.textContent = translations[lang].saveButton;
                productsTitle.textContent = translations[lang].productsTitle;
                idColumn.textContent = translations[lang].idColumn;
                nameColumn.textContent = translations[lang].nameColumn;
                descriptionColumn.textContent = translations[lang].descriptionColumn;
                salePriceColumn.textContent = translations[lang].salePriceColumn;
                stockColumn.textContent = translations[lang].stockColumn;
                subcategoryColumn.textContent = translations[lang].subcategoryColumn;
                brandColumn.textContent = translations[lang].brandColumn;
                imageColumn.textContent = translations[lang].imageColumn;
                actionsColumn.textContent = translations[lang].actionsColumn;
                backButton.textContent = translations[lang].backButton;

                localStorage.setItem("selectedLanguage", lang);
                fetchProducts(); // Refresh action button translations
            }

            const savedLanguage = localStorage.getItem("selectedLanguage") || "en";
            applyTranslations(savedLanguage);

            langButtons.forEach(button => {
                button.addEventListener("click", () => {
                    const lang = button.id.split("-")[0];
                    applyTranslations(lang);
                });
            });

        async function fetchSubcategoriesForProducts() {
            const res = await fetch(`${API_BASE}/subcategories`);
            const subcategories = await res.json();
            subcategorySelect.innerHTML += subcategories.map(subcategory => `
                <option value="${subcategory.id}">${subcategory.name}</option>
            `).join('');
        }

        async function fetchBrandsForProducts() {
            const res = await fetch(`${API_BASE}/brands`);
            const brands = await res.json();
            brandSelect.innerHTML += brands.map(brand => `
                <option value="${brand.id}">${brand.name}</option>
            `).join('');
        }

        async function fetchProducts() {
            const res = await fetch(`${API_BASE}/products`);
            const products = await res.json();
            productList.innerHTML = products.map(product => `
                <tr>
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.description}</td>
                    <td>${product.sale}</td>
                    <td>${product.stockQuantity}</td>
                    <td>${product.subcategory.name}</td>
                    <td>${product.brand.name}</td>
                    <td><img src="${product.image}" alt="${product.name}"></td>
                    <td>
                        <button onclick="editProduct(${product.id})">${translations[savedLanguage].editButton}</button>
                        <button onclick="deleteProduct(${product.id})">${translations[savedLanguage].deleteButton}</button>
                    </td>
                </tr>
            `).join('');
        }

        productForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const formData = new FormData();
            formData.append("name", productName.value);
            formData.append("description", productDescription.value);
            formData.append("sale", productSale.value);
            formData.append("stockQuantity", stockQuantity.value);
            formData.append("subcategoryId", subcategorySelect.value);
            formData.append("brandId", brandSelect.value);
            if (productImage.files[0]) {
                formData.append("image", productImage.files[0]);
            }
            const method = productId.value ? "PUT" : "POST";
            const url = productId.value ? `${API_BASE}/products/${productId.value}` : `${API_BASE}/products`;
            await fetch(url, { method, body: formData });
            productForm.reset();
            productId.value = "";
            fetchProducts();
        });

        async function editProduct(id) {
            const res = await fetch(`${API_BASE}/products/${id}`);
            const product = await res.json();
            productId.value = product.id;
            productName.value = product.name;
            productDescription.value = product.description;
            productSale.value = product.sale;
            stockQuantity.value = product.stockQuantity;
            subcategorySelect.value = product.subcategoryId;
            brandSelect.value = product.brandId;
        }

        async function deleteProduct(id) {
            await fetch(`${API_BASE}/products/${id}`, { method: "DELETE" });
            fetchProducts();
        }

        fetchSubcategoriesForProducts();
        fetchBrandsForProducts();
        fetchProducts();
    </script>
</body>
</html>
