<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Login</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="language-toggle">
        <button id="en-btn">English</button>
        <button id="ar-btn">العربية</button>
    </div>
    <div class="login-container">
        <div class="header">
            <h1 id="login-title">Admin Login</h1>
        </div>
        <div class="container">
            <form id="loginForm">
                <input type="text" id="username" placeholder="Username" required>
                <input type="password" id="password" placeholder="Password" required>
                <button type="submit" id="login-button">Login</button>
            </form>
        </div>
    </div>

    <script>
            const translations = {
                en: {
                    loginTitle: "Admin Login",
                    usernamePlaceholder: "Username",
                    passwordPlaceholder: "Password",
                    loginButton: "Login",
                    loginError: "Invalid Username or Password",
                    loginSuccess: "Login successful!"
                },
                ar: {
                    loginTitle: "تسجيل دخول المسؤول",
                    usernamePlaceholder: "اسم المستخدم",
                    passwordPlaceholder: "كلمة المرور",
                    loginButton: "تسجيل الدخول",
                    loginError: "اسم المستخدم أو كلمة المرور غير صحيحة",
                    loginSuccess: "تم تسجيل الدخول بنجاح!"
                }
            };

            const langButtons = document.querySelectorAll('.language-toggle button');
            const loginTitle = document.getElementById('login-title');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            const loginButton = document.getElementById('login-button');

            function applyTranslations(lang) {
                loginTitle.textContent = translations[lang].loginTitle;
                usernameInput.placeholder = translations[lang].usernamePlaceholder;
                passwordInput.placeholder = translations[lang].passwordPlaceholder;
                loginButton.textContent = translations[lang].loginButton;

                // Save selected language to localStorage
                localStorage.setItem('selectedLanguage', lang);
            }

            // Retrieve saved language from localStorage or default to 'en'
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
            applyTranslations(savedLanguage);

            // Add event listeners to toggle buttons
            langButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const lang = button.id.split('-')[0];
                    applyTranslations(lang);
                });
            });

            // Handle login form submission
            document.getElementById('loginForm').addEventListener('submit', async (event) => {
                event.preventDefault();

                const username = usernameInput.value;
                const password = passwordInput.value;

                try {
                    const response = await fetch('http://localhost:2000/public/loginadminAccount', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password })
                    });

                    if (response.ok) {
                        const data = await response.json(); // Parse the JSON response
                        const token = data.token; // Extract the token from the response
                        console.log(token);
                        if (token) {
                            // Save the token in localStorage
                            localStorage.setItem('authToken', token);
                            
                            alert(translations[savedLanguage].loginSuccess);
                            window.location.href = './dashboard.html'; // Redirect to dashboard
                        } else {
                            alert(translations[savedLanguage].loginError);
                        }
                    } else {
                        const errorData = await response.json();
                        console.error('Login failed:', errorData.message || 'Unknown error');
                        alert(translations[savedLanguage].loginError);
                    }
                } catch (error) {
                    console.error('Login error:', error);
                    alert(translations[savedLanguage].loginError);
                }
            });

    </script>
</body>
</html>
