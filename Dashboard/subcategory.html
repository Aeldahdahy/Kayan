<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Subcategories</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="language-toggle">
        <button id="en-btn">English</button>
        <button id="ar-btn">العربية</button>
    </div>
    <div class="header">
        <h1 id="page-title">Manage Subcategories</h1>
    </div>
    <div class="container">
        <form id="subcategoryForm">
            <h2 id="form-title">Create or Update Subcategory</h2>
            <input type="hidden" id="subcategoryId">
            <input type="text" id="subcategoryName" placeholder="Subcategory Name" required>
            <select id="categoryId" required>
                <option value="" disabled selected id="select-category">Select Category</option>
            </select>
            <button type="submit" id="save-button">Save Subcategory</button>
        </form>
        <h2 id="subcategories-title">All Subcategories</h2>
        <table>
            <thead>
                <tr>
                    <th id="id-column">ID</th>
                    <th id="name-column">Name</th>
                    <th id="category-column">Category</th>
                    <th id="actions-column">Actions</th>
                </tr>
            </thead>
            <tbody id="subcategoryList">
                <!-- Dynamic content -->
            </tbody>
        </table>
        <a href="dashboard.html" class="back-btn btn" id="back-button">Back</a>
    </div>
    <script>
            const API_BASE = "http://localhost:3000/api";

            const translations = {
                en: {
                    pageTitle: "Manage Subcategories",
                    formTitle: "Create or Update Subcategory",
                    subcategoryNamePlaceholder: "Subcategory Name",
                    selectCategory: "Select Category",
                    saveButton: "Save Subcategory",
                    subcategoriesTitle: "All Subcategories",
                    idColumn: "ID",
                    nameColumn: "Name",
                    categoryColumn: "Category",
                    actionsColumn: "Actions",
                    editButton: "Edit",
                    deleteButton: "Delete",
                    backButton: "Back"
                },
                ar: {
                    pageTitle: "إدارة الفئات الفرعية",
                    formTitle: "إنشاء أو تحديث فئة فرعية",
                    subcategoryNamePlaceholder: "اسم الفئة الفرعية",
                    selectCategory: "اختر الفئة",
                    saveButton: "حفظ الفئة الفرعية",
                    subcategoriesTitle: "جميع الفئات الفرعية",
                    idColumn: "الرقم التعريفي",
                    nameColumn: "الاسم",
                    categoryColumn: "الفئة",
                    actionsColumn: "الإجراءات",
                    editButton: "تعديل",
                    deleteButton: "حذف",
                    backButton: "رجوع"
                }
            };

            const pageTitle = document.getElementById("page-title");
            const formTitle = document.getElementById("form-title");
        const subcategoryName = document.getElementById("subcategoryName");
            const selectCategory = document.getElementById("select-category");
            const saveButton = document.getElementById("save-button");
            const subcategoriesTitle = document.getElementById("subcategories-title");
            const idColumn = document.getElementById("id-column");
            const nameColumn = document.getElementById("name-column");
            const categoryColumn = document.getElementById("category-column");
            const actionsColumn = document.getElementById("actions-column");
            const backButton = document.getElementById("back-button");

            const langButtons = document.querySelectorAll(".language-toggle button");

            function applyTranslations(lang) {
                pageTitle.textContent = translations[lang].pageTitle;
                formTitle.textContent = translations[lang].formTitle;
                subcategoryName.placeholder = translations[lang].subcategoryNamePlaceholder;
                selectCategory.textContent = translations[lang].selectCategory;
                saveButton.textContent = translations[lang].saveButton;
                subcategoriesTitle.textContent = translations[lang].subcategoriesTitle;
                idColumn.textContent = translations[lang].idColumn;
                nameColumn.textContent = translations[lang].nameColumn;
                categoryColumn.textContent = translations[lang].categoryColumn;
                actionsColumn.textContent = translations[lang].actionsColumn;
                backButton.textContent = translations[lang].backButton;

                // Save selected language to localStorage
                localStorage.setItem("selectedLanguage", lang);
                fetchSubcategories(); // Refresh subcategories for translated action buttons
            }

            // Retrieve saved language from localStorage or default to 'en'
            const savedLanguage = localStorage.getItem("selectedLanguage") || "en";
            applyTranslations(savedLanguage);

            // Add event listeners to toggle buttons
            langButtons.forEach(button => {
                button.addEventListener("click", () => {
                    const lang = button.id.split("-")[0];
                    applyTranslations(lang);
                });
            });

        async function fetchCategoriesForSubcategory() {
            const res = await fetch(`${API_BASE}/categories`);
            const categories = await res.json();
            categorySelect.innerHTML += categories.map(category => `
                <option value="${category.id}">${category.name}</option>
            `).join('');
        }

        async function fetchSubcategories() {
            const res = await fetch(`${API_BASE}/subcategories`);
            const subcategories = await res.json();
            subcategoryList.innerHTML = subcategories.map(subcategory => `
                <tr>
                    <td>${subcategory.id}</td>
                    <td>${subcategory.name}</td>
                    <td>${subcategory.category.name}</td>
                    <td>
                        <button onclick="editSubcategory(${subcategory.id})">${translations[savedLanguage].editButton}</button>
                        <button onclick="deleteSubcategory(${subcategory.id})">${translations[savedLanguage].deleteButton}</button>
                    </td>
                </tr>
            `).join('');
        }

        subcategoryForm.addEventListener("submit", async (e) => {
            e.preventDefault();
            const data = {
                name: subcategoryName.value,
                categoryId: categorySelect.value,
            };
            const method = subcategoryId.value ? "PUT" : "POST";
            const url = subcategoryId.value ? `${API_BASE}/subcategories/${subcategoryId.value}` : `${API_BASE}/subcategories`;
            await fetch(url, {
                method,
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data),
            });
            subcategoryForm.reset();
            subcategoryId.value = "";
            fetchSubcategories();
        });

        async function editSubcategory(id) {
            const res = await fetch(`${API_BASE}/subcategories/${id}`);
            const subcategory = await res.json();
            subcategoryId.value = subcategory.id;
            subcategoryName.value = subcategory.name;
            categorySelect.value = subcategory.categoryId;
        }

        async function deleteSubcategory(id) {
            await fetch(`${API_BASE}/subcategories/${id}`, { method: "DELETE" });
            fetchSubcategories();
        }

        fetchCategoriesForSubcategory();
        fetchSubcategories();
    </script>
</body>
</html>
