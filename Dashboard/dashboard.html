<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="language-toggle">
        <button id="en-btn">English</button>
        <button id="ar-btn">العربية</button>
    </div>
    <div class="header">
        <h1 id="dashboard-title">Admin Dashboard</h1>
    </div>
    <div class="container">
        <div class="dashboard-buttons">
            <a href="brand.html" id="manage-brands">Manage Brands</a>
            <a href="category.html" id="manage-categories">Manage Categories</a>
            <a href="subcategory.html" id="manage-subcategories">Manage Subcategories</a>
            <a href="product.html" id="manage-products">Manage Products</a>
        </div>
        <button id="logout-btn" class="btn logout-btn">Logout</button>
    </div>
<script>
    const translations = {
        en: {
            dashboardTitle: "Admin Dashboard",
            manageBrands: "Manage Brands",
            manageCategories: "Manage Categories",
            manageSubcategories: "Manage Subcategories",
            manageProducts: "Manage Products",
            logout: "Logout",
            logoutConfirmation: "Do you want to log out?",
            logoutSuccess: "Logged out successfully!"
        },
        ar: {
            dashboardTitle: "لوحة تحكم المسؤول",
            manageBrands: "إدارة العلامات التجارية",
            manageCategories: "إدارة الفئات",
            manageSubcategories: "إدارة الفئات الفرعية",
            manageProducts: "إدارة المنتجات",
            logout: "تسجيل الخروج",
            logoutConfirmation: "هل تريد تسجيل الخروج؟",
            logoutSuccess: "تم تسجيل الخروج بنجاح!"
        }
    };

    const langButtons = document.querySelectorAll('.language-toggle button');
    const dashboardTitle = document.getElementById('dashboard-title');
    const logoutBtn = document.getElementById('logout-btn');
    const manageBrands = document.getElementById('manage-brands');
    const manageCategories = document.getElementById('manage-categories');
    const manageSubcategories = document.getElementById('manage-subcategories');
    const manageProducts = document.getElementById('manage-products');

    function applyTranslations(lang) {
        dashboardTitle.textContent = translations[lang].dashboardTitle;
        manageBrands.textContent = translations[lang].manageBrands;
        manageCategories.textContent = translations[lang].manageCategories;
        manageSubcategories.textContent = translations[lang].manageSubcategories;
        manageProducts.textContent = translations[lang].manageProducts;
        logoutBtn.textContent = translations[lang].logout;

        // Save selected language to localStorage
        localStorage.setItem('selectedLanguage', lang);
    }

    // Retrieve saved language from localStorage or default to 'en'
    const savedLanguage = localStorage.getItem('selectedLanguage') || 'en';
    applyTranslations(savedLanguage);

    // Add event listeners to toggle buttons
    langButtons.forEach(button => {
        button.addEventListener('click', () => {
            const lang = button.id.split('-')[0];
            applyTranslations(lang);
        });
    });

    // Handle logout
    // logoutBtn.addEventListener('click', () => {
    //     const confirmationMessage = translations[savedLanguage].logoutConfirmation;

    //     if (confirm(confirmationMessage)) {
    //         alert(translations[savedLanguage].logoutSuccess);
    //         window.location.href = 'index.html'; // Redirect back to login
    //     }
    // });

    logoutBtn.addEventListener('click', async (event) => {
        event.preventDefault();
        try {
            const token = localStorage.getItem('authToken');
            if(!token){
                alert('You are not logged in.');
                window.location.href = './index.html';
                return;
            }
            
            const response = await fetch('http://localhost:2000/public/logout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}` // Attach token in Authorization header
                }
            });

            if (response.ok) {
                
                localStorage.removeItem('authToken');

                
                alert('Logged out successfully.');
                window.location.href = './index.html';
            } else {
                // Handle errors returned by the server
                const data = await response.json();
                alert(`Logout failed: ${data.message || 'Unknown error'}`);
            }
        } catch (error) {
            console.error('Logout error:', error);
            alert('An error occurred during logout. Please try again.');
        }
    });
    window.addEventListener('popstate', () => {
                if (token) {
                    // Redirect back to the dashboard or current page
                    window.location.href = './dashboard.html';
                }
    });
    
</script>

</body>
</html>
